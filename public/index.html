<!DOCTYPE html>
<html lang='en'>
<head>
	<title>chat</title>
	<line rel='stylesheet' href='css/style.css'></line>
</head>
<body>
	<div id='content'>
		<div id='room'></div>
			<div id='room-list'></div>
			<div id='message'></div>
			<form id='send-form'>
				<input id='send-message' />
				<input id='sned-button' type='submit' value='send' />

				<div id='help'>
					chat commands:
					<ul>
						<li>change name:<code>/nick[username]</code></li>
						<li>join/create room:<code>/join [room name]</code></li>
					</ul>
				</div> 
			</form>
		
	</div>
<script type="text/javascript" src='/socket.io/socket.io.js'></script>
<script type="text/javascript" src='/js/jquery-1.8.3.min.js'></script>
<script type="text/javascript" src='/js/chat.js'></script>
<script type="text/javascript" src='/js/chat_ui.js'></script>
<script type="text/javascript">
	var socket=io.connect();
	$(function(){
		var chatApp=new Chat(socket);

		socket.on('nameResult',function(result){
			var message;

			if(result.success){
				message='you are now know as'+result.name+'.';
			}else{
				message=result.message;
			}
			$('#message').append(divSystemContentElement(message));
		});

		socket.on('joinResult',function(result){
			$('#room').text(result.room);
			$('#message').append(divSystemContentElement('Room changed.'));
		});

		socket.on('message',function(message){
			var newElement=$('<div></div>').text(message.text);
			$('#message').append(newElement);
		});

		socket.on('rooms',function(rooms){
			$('#room-list').empty();

			for(var room in rooms){
				room=room.substring(1,room.length);
				if(room!=''){
					$('#room-list').append(divEscapedContentElement(room));
				}
			}

			$('#room-list div').click(function(){

				chatApp.processCommand('/join'+$(this).text());
				$('#send-message').focus();
			});
		});
		setInterval(function(){
			socket.emit('rooms');
		},1000);

		$('#send-message').focus();

		$('#send-form').submit(function(){
			processUserInput(chatApp,socket);
			return false;
		});
	});
</script>

</body>
</html>